<!DOCTYPE html>
<html lang="ja">
<head>
	<meta charset="UTF-8">
	<title>NFCテスト</title>
	<link rel="stylesheet" href="css.css">
	<style>
	body{ font-size:16pt; font-weight:bold; }
	h1 { color:white;padding:5px; font-size:24pt;
		background-color:red; }
	</style>
	<script src="NFCTest.js"></script>
	<script>
		let vid;
		let cams;

		async function startCamera() {
		  const cameraStream = await navigator.mediaDevices.getUserMedia({
			video: {
			  facingMode: 'environment',
  
			  aspectRatio: {
				exact: 1.6,
			  },
			},
			audio: false,
		  });
		  const videoElement = document.createElement("video")
		  vid = videoElement;
		  videoElement.autoplay = true;
		  videoElement.srcObject = cameraStream;
		  document.getElementById("innerModal").append(videoElement);
		  videoElement.addEventListener("resize", () => {
			videoElement.width = videoElement.videoWidth;
			videoElement.height = videoElement.videoHeight;
		  });

		  cams = cameraStream;
		}

		function cameraStop()
		{
			vid.remove();
			cams.getTracks()[0].stop();
		}

		async function cameraPause()
		{
			if (!("BarcodeDetector" in window)) {
				alert("Barcode Detector はこのブラウザーでは対応していません。"); return;
			} else {
				console.log("Barcode Detector に対応しています。");
			}

			vid.pause();
			const detector = new BarcodeDetector();
			const detectionList = await detector.detect(vid);
			console.log(detectionList);

			if (!confirm(`${detectionList["rawValue"]}でお間違いないですか?`))
			{
				cameraStop();
				startCamera();
				return;
			}
		}
	  </script>
</head>

<body>

	<button onclick="ScanNFC();">Scan!</button>
	<br>
	<textarea id="log" style="width: 75%; height: 500px;"></textarea>

	<div class="modal-2__wrap">
		<input type="radio" id="modal-2__open" class="modal-2__open-input" name="modal-2__trigger"/ onclick="startCamera();">
		<label for="modal-2__open" class="modal-2__open-label">モーダルを開く</label>
		<input type="radio" id="modal-2__close" name="modal-2__trigger"/>
		<div class="modal-2">
			<div class="modal-2__content-wrap">
				<label for="modal-2__close" class="modal-2__close-label" onclick="cameraStop();">×</label>
				<div class="modal-2__content">
					バーコードを写してください
					<div id="innerModal" style="margin: 10px;">
					</div>
					<br>
					<button style="width: 300px; height: 30px;" onclick="cameraPause();">読み込む</button>
				</div>
			</div>
			<label for="modal-2__close">
				<div class="modal-2__background" onclick="cameraStop();"></div>
			</label>
		</div>
	</div>

</body>

</html>
